apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: minio
  namespace: csv-processor
spec:
  interval: 30m
  chart:
    spec:
      chart: minio
      version: "5.*"
      sourceRef:
        kind: HelmRepository
        name: minio
        namespace: flux-system
      interval: 12h
  values:
    # Deployment mode
    mode: standalone
    replicas: 1

    # Root credentials
    rootUser: minioadmin
    rootPassword: minioadmin123

    # Persistence
    persistence:
      enabled: true
      storageClass: "standard"
      accessMode: ReadWriteOnce
      size: 10Gi

    # Resources
    resources:
      requests:
        memory: 256Mi

    # Ingress for MinIO API (S3 - port 9000)
    ingress:
      enabled: true
      ingressClassName: nginx
      annotations:
        nginx.ingress.kubernetes.io/proxy-body-size: "0"
        nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
        nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
      hosts:
        - minio-api.local
      path: /

    # Console Ingress (Web UI - port 9001)
    consoleIngress:
      enabled: true
      ingressClassName: nginx
      annotations:
        nginx.ingress.kubernetes.io/proxy-body-size: "0"
        nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
        nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
      hosts:
        - minio.local
      path: /

    # Service configuration
    service:
      type: ClusterIP
      port: 9000

    consoleService:
      type: ClusterIP
      port: 9001

    # Create default buckets
    buckets:
      - name: test-bucket
        policy: none
        purge: false

    # Disable distributed mode for standalone
    drivesPerNode: 1
    zones: 1
